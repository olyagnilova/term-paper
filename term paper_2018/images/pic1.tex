\documentclass{article}
%%%<
\usepackage{verbatim}
%%%>

\usepackage{tikz}   %TikZ is required for this to work.  Make sure this exists before the next line

\usepackage{tikz-3dplot} %requires 3dplot.sty to be in same directory, or in your LaTeX installation
\usepackage{tkz-euclide}
\usetkzobj{all}
\usepackage[active,tightpage]{preview}  %generates a tightly fitting border around the work
\PreviewEnvironment{tikzpicture}
\setlength\PreviewBorder{2mm}

\begin{document}

%Angle Definitions
%-----------------

%start tikz picture, and use the tdplot_main_coords style to implement the display
%coordinate transformation provided by 3dplot
\tdplotsetmaincoords{40}{130}


\begin{tikzpicture}[scale=5,tdplot_main_coords]

\coordinate (O) at (0,0,0);
\coordinate (xc) at (1,0);
\coordinate (yc) at (0,2);
\coordinate (un) at (0,0,4);

\draw[->] (O) -- (xc) node[anchor=north east]{$x - \bar{x} \cdot \mathbf{1}$};
\draw[->] (O) -- (yc) node[anchor=north west]{$y - \bar{y} \cdot \mathbf{1}$};
\draw[thick,->] (O) -- (un) node[anchor=south]{$\mathbf{1}$};

\tdplotdrawarc{(O)}{0.1}{0}{90}{anchor=north}{$\phi$}

\tdplotsetcoord{S}{2}{30}{0}  % икс
\tdplotsetcoord{P}{4}{30}{90} % игрек
\tdplotsetcoord{T}{3.6}{12}{0} % игрек с крышкой
\tdplotsetcoord{Z}{3.4641}{0}{0} % 3.4641 = \sqrt{4^2 - 2^2}


\draw[-stealth,thick] (O) -- (S) node[anchor=north east]{$x$};
\draw[-stealth,thick] (O) -- (P) node[anchor=north west]{$y$};

%\draw[->] (O) -- (Z) node[anchor=north east]{$\bar{y}\cdot\mathbf{1}$};

\draw[dashed] (S) -- (Sx);
\draw[dashed] (P) -- (Py);


\tkzMarkRightAngle[size=0.05](P,yc,O);
\tkzMarkRightAngle[size=0.05](S,xc,O);

\draw[-stealth] (O) -- (T) node[anchor=south east]{$\hat{y}$};

\draw (P) -- (Z) node[midway, anchor=south west] {$\sqrt{TSS}$};
\draw (T) -- (Z) node[midway, anchor=east] {$\sqrt{ESS}$};

\draw[dashed, color=red] (T) -- (Tx);
\tkzMarkRightAngle[color=red,size=0.05](T,Tx,O);

\draw (P) -- (T) node[midway, anchor=north] {$\sqrt{RSS}$};
\tkzMarkRightAngle[size=0.05](P,T,Z);
\tkzMarkRightAngle[size=0.05](P,Z,un);
\tkzMarkRightAngle[size=0.05](T,Z,un);

\tdplotdrawarc{(Z)}{0.1}{0}{90}{anchor=north west}{$\phi$}

\draw[->] (O) -- (Tx) node[anchor=north west] {$\hat{y} - \bar{\hat{y}} \cdot \mathbf{1}$};


\draw[dotted] (S) to[out=90,in=180] (un);



\end{tikzpicture}


\end{document}
